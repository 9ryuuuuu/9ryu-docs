# Gitでの変更を一度にPushする方法とシェルスクリプトの作成・解説

Gitリポジトリで新規に作成したファイルや、既存ファイルを編集した場合、すべての変更を一括でPushする方法と、あらかじめステージングしている変更だけをPushする方法、そしてこれらをシェルスクリプトにまとめて呼び出す方法について解説します。

## 1. 新規作成・編集したファイルを一度にPushする方法

新規作成したファイルや、編集したファイル（削除含む）など、すべての変更を自動的にステージングしてコミット・Pushするには、以下の1行コマンドを使います。

```bash
git add -A && git commit -m "Auto-commit on $(date '+%Y-%m-%d %H:%M:%S')" && git push
```

### コマンドの解説

- **`git add -A`**  
  - 新規ファイル、修正されたファイル、削除されたファイルなど、すべての変更をステージングします。
- **`&&`**  
  - 直前のコマンドが成功した場合のみ、次のコマンドを実行します。
- **`git commit -m "..."`**  
  - ステージングされた変更を、指定したメッセージ（ここでは現在の日時を自動で挿入）でコミットします。
- **`git push`**  
  - ローカルリポジトリの最新コミットをリモートリポジトリに送信します。

## 2. ステージ済みのファイルだけをPushする方法

既にユーザーが手動で `git add` してステージングした変更だけを対象にコミット・Pushする場合は、以下の1行コマンドを使います。

```bash
git commit -m "Auto-commit on $(date '+%Y-%m-%d %H:%M:%S')" && git push
```

### コマンドの解説

- **`git commit -m "..."`**  
  - すでにステージングされている変更を、現在の日時を含むメッセージでコミットします。
- **`git push`**  
  - そのコミットをリモートリポジトリに反映します。

> **注意:**  
> `git commit -a` オプションは既存の tracked ファイルの変更は自動でステージングしますが、新規ファイルには対応していません。新規ファイルも含める場合は `git add -A` を使用してください。

## 3. これらのコマンドをシェルスクリプトにして呼び出す方法

Mac環境などでは、これらのコマンドをシェルスクリプトとして保存し、PATHに含まれるディレクトリ（例えば `~/bin`）に配置することで、どこからでも呼び出せるようにできます。

### シェルスクリプト例

以下は、リポジトリ内の変更をすべてPushするスクリプト例です。

```bash
#!/bin/bash
# Git リポジトリのルートに移動する
cd "$(git rev-parse --show-toplevel)" || exit 1

# すべての変更をステージングし、現在の日時を含むコミットメッセージでコミット＆Pushする
git add -A && git commit -m "Auto-commit on $(date '+%Y-%m-%d %H:%M:%S')" && git push
```

### スクリプトの設置手順

1. 上記の内容をファイル（例: `gapush.sh`）として保存します。
2. 実行権限を付与します。

   ```bash
   chmod +x gapush.sh
   ```

3. ユーザー固有のスクリプト管理用ディレクトリ `~/bin` に移動します。まだ存在しない場合は作成します。

   ```bash
   mkdir -p ~/bin
   mv gapush.sh ~/bin/
   ```

4. もし `~/bin` が PATH に含まれていなければ、シェルの設定ファイル（例: `~/.bashrc` や `~/.zshrc`）に以下を追加し、PATHに登録します。

   ```bash
   export PATH="$HOME/bin:$PATH"
   ```

5. ターミナルを再起動するか、設定ファイルを再読み込みして、`gapush.sh` コマンドがどこからでも実行できるようになります。

### まとめたシェルスクリプトの解説

- **シバン行 (`#!/bin/bash`)**  
  - この行はスクリプトを Bash で実行するための宣言です。

- **`cd "$(git rev-parse --show-toplevel)" || exit 1`**  
  - この部分は、現在の作業ディレクトリが Git リポジトリのどこにいても、リポジトリのルートディレクトリに移動する処理です。  
  - `git rev-parse --show-toplevel` は現在のリポジトリのルートディレクトリのパスを出力し、その結果を `cd` コマンドで利用しています。  
  - もしこの操作に失敗した場合は、`exit 1` によりスクリプトが終了します。

- **`git add -A && git commit -m "Auto-commit on $(date '+%Y-%m-%d %H:%M:%S')" && git push`**  
  - この行で、すべての変更をステージングし、現在の日時を含むコミットメッセージでコミットし、最後にリモートに Push する一連の操作を行っています。  
  - `$(date '+%Y-%m-%d %H:%M:%S')` はシェルのコマンド置換を用いて現在の日時を生成します。

---

## 4. まとめ

この記事では、以下の内容を解説しました。

- **新規作成・編集したファイルを一括でPushする方法**  
  `git add -A && git commit -m "Auto-commit on $(date '+%Y-%m-%d %H:%M:%S')" && git push`

- **ステージ済みの変更だけをPushする方法**  
  `git commit -m "Auto-commit on $(date '+%Y-%m-%d %H:%M:%S')" && git push`

- **これらのコマンドをシェルスクリプトにまとめ、PATHに登録する方法**  
  例として、Gitリポジトリのルートディレクトリに移動してから全変更をPushするスクリプト `gapush.sh` を作成し、`~/bin` に配置する方法を説明しました。

- **シェルスクリプトの各部分の詳細解説**  
  シバン行、Gitリポジトリのルートへの移動、Git コマンドの実行順序とその意味などを解説しました。

このようにシェルスクリプトを活用すれば、どこからでも簡単に自動Pushが実行でき、作業効率の向上が期待できます。ぜひ、実際に設定してみてください。