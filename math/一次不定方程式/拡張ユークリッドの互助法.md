拡張ユークリッドの互除法は、通常のユークリッドの互除法で \( \gcd(a, b) \) を求める過程に加えて、以下の等式

\[
ax_0 + by_0 = \gcd(a, b)
\]

を満たす整数 \( x_0 \) と \( y_0 \) をも求める方法です。以下、その手順を具体的に説明します。

---

### 1. ユークリッドの互除法の復習

ユークリッドの互除法は、2つの整数 \(a\) と \(b\) の最大公約数を求めるアルゴリズムです。基本的な考え方は、次の性質に基づいています。

\[
\gcd(a, b) = \gcd(b, a \bmod b)
\]

つまり、\(a\) を \(b\) で割った余り \(r = a \bmod b\) に対して、\(\gcd(a, b)\) は \(\gcd(b, r)\) と同じになります。これを \(r = 0\) になるまで繰り返します。

---

### 2. 拡張ユークリッドの互除法の目的

拡張ユークリッドの互除法とは、通常のユークリッドの互除法（最大公約数を求めるアルゴリズム）の発展形です。通常のユークリッドの互除法では、2つの整数 a と b の最大公約数 (gcd) を求めますが、拡張ユークリッドの互除法では、それに加えて、以下の形の線形結合

$$
a x_0 + b y_0 = \gcd(a,b)
$$

を満たす整数 $x_0$ と $y_0$ も同時に求めることができます。

### 具体的には

- **目的**  
  単に $gcd(a, b)$ を計算するだけでなく、どのように $a$ と $b$ の組み合わせ（つまり、$a$ と $b$ の適切な倍数の和）でその最大公約数が表せるかを求めることが目的です。

- **なぜ重要か**  
  この線形結合の形は、後に一次不定方程式（例えば $ax+by=c$ の解法）や、RSA暗号のような暗号アルゴリズムで秘密鍵を求めるときなど、さまざまな応用で利用されます。  
  例えば、$ax+by=c$ の解が存在するためには、$c$ が $gcd(a, b)$ の倍数である必要がありますし、そのときの具体的な解は、拡張ユークリッドの互除法で求めた $x₀, y₀$ を用いて構成できます。

- **まとめ**  

  拡張ユークリッドの互除法は、「$a$ と $b$ の最大公約数がどのような整数の線形結合で表せるか」という情報を同時に提供するため、単に $gcd$ を求めるだけの通常のユークリッドの互除法よりも強力で、多くの実用的な問題（整数論、暗号、Diophantine 方程式など）の解法に応用される重要な手法なのです。


---

### 3. 拡張ユークリッドの互除法の手順

以下、アルゴリズムを再帰的な形で説明します。

#### 【基本ケース】
- **もし \( b = 0 \) なら：**  
  このとき、\(\gcd(a, 0) = a\) です。  
  また、等式 \( a \times 1 + 0 \times 0 = a \) から、  
  \[
  x_0 = 1, \quad y_0 = 0
  \]
  と置くことができます。

#### 【再帰的ステップ】
- **\(b \neq 0\) の場合：**  
  まず \(a\) を \(b\) で割って、商 \(q\) と余り \(r\) を求めます。つまり、
  \[
  a = bq + r \quad \text{（ここで } r = a \bmod b \text{）}
  \]
  
  次に、再帰的に、\(b\) と \(r\) の組に対して拡張ユークリッドの互除法を適用し、以下の等式を満たす \(x_1\) と \(y_1\) を求めます。
  \[
  bx_1 + ry_1 = \gcd(b, r)
  \]
  
  ここで、ユークリッドの互除法の性質から、
  \[
  \gcd(a, b) = \gcd(b, r)
  \]
  が成立しているので、この \(\gcd\) は実は \(\gcd(a, b)\) でもあります。

  さらに、\(r\) は \(a\) と \(b\) の関係式
  \[
  r = a - bq
  \]
  によって表されるので、上の等式に代入すると、
  \[
  bx_1 + (a - bq)y_1 = a\,y_1 + b(x_1 - q\,y_1)
  \]
  
  この形は、\( a \) と \( b \) の線形結合になっているので、以下のように係数を定めればよいことがわかります：
  \[
  x_0 = y_1,\quad y_0 = x_1 - q\,y_1
  \]
  すると、
  \[
  ax_0 + by_0 = a\,y_1 + b(x_1 - q\,y_1) = bx_1 + a\,y_1 - bq\,y_1 = bx_1 + (a - bq)y_1 = bx_1 + r\,y_1
  \]
  となり、これは再帰的に求めた
  \[
  bx_1 + ry_1 = \gcd(b, r) = \gcd(a, b)
  \]
  と一致します。

---

### 4. アルゴリズムの擬似コード

以下は、拡張ユークリッドの互除法の擬似コードです。

```plaintext
function extended_gcd(a, b):
    if b == 0:
        return (a, 1, 0)  // gcd(a,0)=a, 係数 x=1, y=0
    else:
        (d, x1, y1) = extended_gcd(b, a mod b)
        x = y1
        y = x1 - floor(a/b) * y1
        return (d, x, y)
```

- **説明：**  
  - \( b = 0 \) の場合、直接 \( (a, 1, 0) \) を返します。  
  - \( b \neq 0 \) の場合、\( a \mod b \) を用いて再帰的に \( \gcd(b, a \bmod b) \) と係数 \( x_1, y_1 \) を求めます。  
  - 商 \( q = \lfloor a/b \rfloor \) を使って、新しい係数 \( x, y \) を
    \[
    x = y_1,\quad y = x_1 - q\,y_1
    \]
    として計算し、\( (d, x, y) \) を返します。

---

### 5. 具体例

例えば、\( a = 30 \) と \( b = 12 \) の場合を考えます。

1. **第一段階：**  
   \(30 = 12 \times 2 + 6\)  
   よって、\( q = 2 \) で \( r = 6 \)。

2. **再帰呼び出し：**  
   \( \text{extended\_gcd}(12, 6) \) を計算します。  
   \( 12 = 6 \times 2 + 0 \) なので、  
   \(\gcd(12, 6) = 6\) で、特殊解は \( x_1 = 1 \), \( y_1 = 0 \) （この場合、直接基本ケースに到達）。

3. **戻りながら係数計算：**  
   \( x = y_1 = 0 \)  
   \( y = x_1 - 2 \times y_1 = 1 - 2 \times 0 = 1 \)  
   しかし、ここで \( 12 \times 1 + 6 \times 0 = 12 \) となり、実際にはもう一段階戻る必要があります。  
   より正確には、再帰呼び出しの前の段階での計算は以下のようになります。

   正しい計算の流れを改めて示すと、  
   - **基本ケース:**  
     \( \text{extended\_gcd}(6, 0) = (6, 1, 0) \)
   - **1段階上:**  
     \( \text{extended\_gcd}(12, 6) \) で、\( 12 = 6 \times 2 + 0 \)  
     よって、\( x_1 = 0, y_1 = 1 \) （実際は \( x = 1 \) で \( y = 0 \) に対応するように定めます）  
     （ここは各実装によって若干の違いがありますが、最終的な結論として、  
     \( 12 \times 0 + 6 \times 1 = 6 \) となるような係数が得られます。）
   - **さらに上:**  
     \( \text{extended\_gcd}(30, 12) \) で、  
     \( x = y_1 \) で \( x = 1 \) となり、  
     \( y = x_1 - 2 \times y_1 = 0 - 2 \times 1 = -2 \)  
     したがって、  
     \( 30 \times 1 + 12 \times (-2) = 30 - 24 = 6 \)  
     となり、正しく \(\gcd(30, 12) = 6\) を表す整数解が得られます。

（具体例では、係数の符号や順序が実装によって異なる場合がありますが、基本的なアイデアは同じです。）

---

### 6. まとめ

拡張ユークリッドの互除法は、以下のように動作します：

1. **基本ケース：**  
   \( b = 0 \) なら、\(\gcd(a, 0)=a\) として \( x=1, y=0 \) を返す。

2. **再帰的に計算：**  
   \( a = bq + r \) として、再帰的に \( \gcd(b, r) \) とその係数 \( x_1, y_1 \) を求める。

3. **係数の更新：**  
   得られた \( x_1, y_1 \) を用いて、  
   \[
   x = y_1,\quad y = x_1 - q\,y_1
   \]
   として、\( ax + by = \gcd(a, b) \) を満たす \( x \) と \( y \) を計算する。

この方法により、単に最大公約数を求めるだけでなく、\(a\) と \(b\) の線形結合としてその最大公約数を表現する整数解も得ることができます。

---
# 拡張ユークリッドの互除法：再帰的ステップの丁寧な説明

拡張ユークリッドの互除法では、単に最大公約数を求めるだけでなく、下記の形の線形結合  
$$
ax_0 + by_0 = \gcd(a, b)
$$  
を表す整数 $x_0$ と $y_0$ も同時に求めます。ここでは、再帰的ステップの部分について、具体的に丁寧に解説します。

---

## 再帰的ステップの全体の流れ

1. **割り算を行う:**  
   $a$ を $b$ で割って、商 $q$ と余り $r$ を求めます。  
   $$ a = bq + r \quad \text{（ただし } 0 \le r < b \text{）} $$
   このとき、$a \mod b$ は余り $r$ を意味します。

2. **再帰呼び出し:**  
   $b \neq 0$ の場合、今度は $b$ と余り $r$ に対して拡張ユークリッドの互除法を適用します。  
   つまり、次の等式を満たす整数 $x_1$ と $y_1$ を求めます。
   $$ b x_1 + r y_1 = \gcd(b, r) $$
   ここで、ユークリッドの互除法の性質から、  
   $$ \gcd(a, b) = \gcd(b, r) $$
   が成り立つので、この再帰呼び出しによって求めた $\gcd(b, r)$ は $\gcd(a, b)$ と同じ値になります。

3. **再帰呼び出しから戻ってくる:**  
   再帰的な呼び出しによって得られた $x_1$ と $y_1$ を使い、元の式  
   $$ ax_0 + by_0 = \gcd(a, b) $$
   を満たす $x_0$, $y_0$ を計算します。

---

## 再帰的ステップの詳細な説明

### (1) 商と余りの計算

- **割り算の式:**  
  $$ a = bq + r $$
  ここで、$q$ は商、$r = a \mod b$ は余りです。

### (2) 再帰呼び出しの結果

- 再帰的に、$b$ と $r$ に対して以下の等式が成り立つ整数 $x_1$, $y_1$ を求めます。
  $$ b x_1 + r y_1 = \gcd(b, r) $$
- なお、$\gcd(b, r)$ はユークリッドの互除法により $\gcd(a, b)$ と等しいので、  
  $$ b x_1 + r y_1 = \gcd(a, b) $$

### (3) $r$ の表し方とその代入

- 余り $r$ は、先ほどの割り算の式から  
  $$ r = a - bq $$
  と表せます。

- この $r$ を、再帰呼び出しの等式に代入すると、
  $$
  b x_1 + (a - bq) y_1 = b x_1 + a y_1 - bq y_1.
  $$

- この式を整理すると、  
  $$
  a y_1 + b (x_1 - q y_1).
  $$

### (4) $x_0$ と $y_0$ の決定

- 上記の形が、もともと求めたい
  $$ ax_0 + by_0 = \gcd(a, b) $$
  と一致するように、次のように係数を定めます:
  - $$ x_0 = y_1 $$
  - $$ y_0 = x_1 - q y_1 $$

- このように定めると、
  $$
  a x_0 + b y_0 = a y_1 + b(x_1 - q y_1) = a y_1 + b x_1 - bq y_1.
  $$
  これは先ほど整理した式  
  $$
  b x_1 + a y_1 - bq y_1
  $$
  と同じであり、結果として
  $$
  a x_0 + b y_0 = b x_1 + (a - bq)y_1 = b x_1 + r y_1 = \gcd(b, r) = \gcd(a, b)
  $$
  が成立します。

---

## 5. まとめ

拡張ユークリッドの互除法の再帰的ステップは次のように進みます:

1. **割り算:**  
   $$ a = bq + r \quad (r = a \mod b) $$
2. **再帰呼び出し:**  
   $$ b x_1 + r y_1 = \gcd(b, r) $$
3. **余りの置き換え:**  
   $$ r = a - bq $$
4. **係数の更新:**  
   $$ x_0 = y_1, \quad y_0 = x_1 - q y_1 $$
5. **元の等式の成立:**  
   $$ ax_0 + by_0 = \gcd(a, b) $$

このプロセスにより、最大公約数だけでなく、その最大公約数を $a$ と $b$ の線形結合として表現するための具体的な係数も求めることができ、これが拡張ユークリッドの互除法の本質となります.
